---
    -   hosts: 127.0.0.1
        connection: local
        become: yes
        remote_user: root
        vars:
            GTP5G_DIR_INSTALL : "/root/gtp5g"
            FREE5GC_DIR_INSTALL : "/root/go/src/free5gc"
            UPF_DIR_CONFIG : "/root/go/src/free5gc/NFs/upf/build/config"
            WEB_CONSOLE_FRONTEND_DIR : "/root/go/src/free5gc/webconsole/frontend"
            WEB_CONSOLE_BASE_DIR : "/root/go/src/free5gc/webconsole"
            NFS_DIR_CONFIG : "/root/go/src/free5gc/config"
            GO_SRC_DIR : "/root/go/src"
            HOME_DIR: "/root"
            FREE5GC_GIT_CHECKOUT_URL_FREEGC_TAG_VERSION: "--recursive -b v3.0.5 -j `nproc` https://github.com/free5gc/free5gc.git"
            FREE5GC_GIT_CHECKOUT_URL_CIRO: "https://github.com/ciromacedo/free5gc-devmode.git"
            FREE5GC_CHECKOUT_FOLDER_NAME: "free5gc"
            PREDEFINED_IP_ADDRESS: "false"
            FREE5GC: "false"
            MONGO_URL_CONNECTION: "mongodb://127.0.0.1:27017"
            NRF_IP_ADDRESS: "127.0.0.10"
            NRF_PORT: "8000"
            UDR_IP_ADDRESS: "127.0.0.4"
            UDR_PORT: "8000"
            UDM_IP_ADDRESS: "127.0.0.3"
            UDM_PORT: "8000"
            AUSF_IP_ADDRESS: "127.0.0.9"
            AUSF_PORT: "8000"
            NSSF_IP_ADDRESS: "127.0.0.31"
            NSSF_PORT: "8000"
            AMF_NGAP_IP_ADDRESS: "127.0.0.1"
            AMF_IP_ADDRESS: "127.0.0.18"
            AMF_PORT: "8000"
            PCF_IP_ADDRESS: "127.0.0.7"
            PCF_PORT: "8000"
            SMF_N3_INTERFACE_IP_ADDRESS: "127.0.0.1"
            SMF_IP_ADDRESS: "127.0.0.2"
            SMF_PORT: "8000"
            UPF_IP_ADDRESS: "127.0.0.8"
            GTPU_UPF_IP_ADDRESS: "127.0.0.8"
            
        tasks:
            - fail: 
                msg: "'internet_network_interface' not found, this parameter is required!"
              when: internet_network_interface == ''

            - name: Environment validation!
              assert:
                that:
                  - ansible_memtotal_mb >= 500
                msg: "Minimum memory requirements in the deployment environment is 4GB! Operation failed!"
    
            - set_fact:
                AMF_NGAP_IP_ADDRESS: "{{ ansible_default_ipv4.address }}"
                SMF_N3_INTERFACE_IP_ADDRESS: "{{ ansible_default_ipv4.address }}"
                GTPU_UPF_IP_ADDRESS: "{{ ansible_default_ipv4.address }}"
              when: PREDEFINED_IP_ADDRESS == 'false'

            - name: Upgrade all apt packages
              apt: upgrade=dist force_apt_get=yes
            
            - name: Install Basic requirements
              apt:
                    name: ['mongodb', 'wget', 'git', 'ca-certificates', 'net-tools', 'gcc', 'cmake', 'autoconf', 'build-essential', 'libtool', 'pkg-config', 'libmnl-dev', 'libyaml-dev']
                    state: present
                    update_cache: yes

            - name: Start Mongo-DB
              shell:  sudo systemctl start mongodb

            - name: Install WebConsole front-end dependencies
              shell :  |
                    curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
                    echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
                    sudo apt update && sudo apt -y install yarn
            
            - name: Remove GTP5G (if exists)
              shell:  sudo rm -rf {{ GTP5G_DIR_INSTALL }}
              ignore_errors: true

            - name: Remove free5GC dir (if exists)
              shell:  sudo rm -rf {{ FREE5GC_DIR_INSTALL }}
              ignore_errors: true

            - name: User-plane Supporting Packages
              shell: go get -u github.com/sirupsen/logrus

            - name  : Git Clone GTP5
              shell : git clone -b v0.2.1 https://github.com/free5gc/gtp5g.git
              args:
                chdir: "{{ HOME_DIR }}"

            - name: Install linux-headers-5.0.0-23-generic
              shell: sudo apt-get install -y linux-headers-5.0.0-23-generic
                     
            - name  : Run 'Make' into GTP5G
              shell : make
              args:
                chdir: "{{ GTP5G_DIR_INSTALL }}"

            - name  : Install GTP5G
              shell : sudo make install
              args:
                chdir: "{{ GTP5G_DIR_INSTALL }}"
              ignore_errors: true

            - name  : Network Setting 1/4
              shell : sudo sysctl -w net.ipv4.ip_forward=1

            - name  : Network Setting 2/4
              shell : sudo iptables -t nat -A POSTROUTING -o {{ internet_network_interface }} -j MASQUERADE
            
            - name  : Network Setting 3/4
              shell : sudo iptables -A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --set-mss 1400

            - name  : Network Setting 4/4
              shell : sudo systemctl stop ufw

            - name  : Install by free5gc TAG Version
              shell : git clone {{ FREE5GC_GIT_CHECKOUT_URL_FREEGC_TAG_VERSION }} {{ FREE5GC_CHECKOUT_FOLDER_NAME }}
              args:
                chdir: "{{ GO_SRC_DIR }}"
              when  : FREE5GC == 'true'

            - name  : Install by ciromacedo Fork free5gc version
              shell : git clone {{ FREE5GC_GIT_CHECKOUT_URL_CIRO }} {{ FREE5GC_CHECKOUT_FOLDER_NAME }}
              args:
                chdir: "{{ GO_SRC_DIR }}"
              when  : FREE5GC == 'false'

            - name  : Remove nrfcfg.yaml default file config
              shell : rm nrfcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build nrfcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/nrfcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: NRF initial local configuration

                  configuration:
                    MongoDBName: free5gc # database name in MongoDB
                    MongoDBUrl: {{ MONGO_URL_CONNECTION }} # a valid URL of the mongodb
                    sbi: # Service-based interface information
                      scheme: http # the protocol for sbi (http or https)
                      registerIPv4: {{ NRF_IP_ADDRESS }} # IP used to serve NFs or register to another NRF
                      bindingIPv4: {{ NRF_IP_ADDRESS }}  # IP used to bind the service
                      port: {{ NRF_PORT }} # port used to bind the service
                    DefaultPlmnId:
                      mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)
                      mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                    serviceNameList: # the SBI services provided by this NRF, refer to TS 29.510
                      - nnrf-nfm # Nnrf_NFManagement service
                      - nnrf-disc # Nnrf_NFDiscovery service

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    NRF:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false
                    OpenApi:
                      debugLevel: info
                      ReportCaller: false
                    MongoDBLibrary:
                      debugLevel: info
                      ReportCaller: false

            - name  : Remove udrcfg.yaml default file config
              shell : rm udrcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build udrcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/udrcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: UDR initial local configuration

                  configuration:
                    sbi: # Service-based interface information
                      scheme: http # the protocol for sbi (http or https)
                      registerIPv4: {{ UDR_IP_ADDRESS }} # IP used to register to NRF
                      bindingIPv4: {{ UDR_IP_ADDRESS }}  # IP used to bind the service
                      port: {{ UDR_PORT }} # port used to bind the service
                    mongodb:
                      name: free5gc # Database name in MongoDB
                      url: {{ MONGO_URL_CONNECTION }} # URL of MongoDB
                    nrfUri: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }} # a valid URI of NRF

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    UDR:
                      debugLevel: debug
                      ReportCaller: false
                    MongoDBLibrary:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false
                    OpenApi:
                      debugLevel: info
                      ReportCaller: false

            - name  : Remove udmcfg.yaml default file config
              shell : rm udmcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build udmcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/udmcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: UDM initial local configuration

                  configuration:
                    serviceNameList: # the SBI services provided by this UDM, refer to TS 29.503
                      - nudm-sdm # Nudm_SubscriberDataManagement service
                      - nudm-uecm # Nudm_UEContextManagement service
                      - nudm-ueau # Nudm_UEAuthenticationManagement service
                      - nudm-ee # Nudm_EventExposureManagement service
                      - nudm-pp # Nudm_ParameterProvisionDataManagement service
                    sbi: # Service-based interface information
                      scheme: http # the protocol for sbi (http or https)
                      registerIPv4: {{ UDM_IP_ADDRESS }} # IP used to register to NRF
                      bindingIPv4: {{ UDM_IP_ADDRESS }}  # IP used to bind the service
                      port: {{ UDM_PORT }} # Port used to bind the service
                      tls: # the local path of TLS key
                        log: free5gc/udmsslkey.log # UDM keylog
                        pem: free5gc/support/TLS/udm.pem # UDM TLS Certificate
                        key: free5gc/support/TLS/udm.key # UDM TLS Private key
                    nrfUri: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }} # a valid URI of NRF

                    # test data set from TS33501-f60 Annex C.4
                    keys:
                      udmProfileAHNPublicKey: 5a8d38864820197c3394b92613b20b91633cbd897119273bf8e4a6f4eec0a650
                      udmProfileAHNPrivateKey: c53c22208b61860b06c62e5406a7b330c2b577aa5558981510d128247d38bd1d
                      udmProfileBHNPublicKey: 0472DA71976234CE833A6907425867B82E074D44EF907DFB4B3E21C1C2256EBCD15A7DED52FCBB097A4ED250E036C7B9C8C7004C4EEDC4F068CD7BF8D3F900E3B4
                      udmProfileBHNPrivateKey: F1AB1074477EBCC7F554EA1C5FC368B1616730155E0041AC447D6301975FECDA

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    UDM:
                      debugLevel: info
                      ReportCaller: false
                    OpenApi:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false

            - name  : Remove ausfcfg.yaml default file config
              shell : rm ausfcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build ausfcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/ausfcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: AUSF initial local configuration

                  configuration:
                    sbi: # Service-based interface information
                      scheme: http # the protocol for sbi (http or https)
                      registerIPv4: {{ AUSF_IP_ADDRESS }} # IP used to register to NRF
                      bindingIPv4: {{ AUSF_IP_ADDRESS }}  # IP used to bind the service
                      port: {{ AUSF_PORT }} # Port used to bind the service
                    serviceNameList: # the SBI services provided by this AUSF, refer to TS 29.509
                      - nausf-auth # Nausf_UEAuthentication service
                    nrfUri: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }} # a valid URI of NRF
                    plmnSupportList: # the PLMNs (Public Land Mobile Network) list supported by this AUSF
                      - mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)
                        mnc: 93  # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                      - mcc: 123 # Mobile Country Code (3 digits string, digit: 0~9)
                        mnc: 45  # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                    groupId: ausfGroup001 # ID for the group of the AUSF

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    AUSF:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false
                    OpenApi:
                      debugLevel: info
                      ReportCaller: false

            - name  : Remove nssfcfg.yaml default file config
              shell : rm nssfcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build nssfcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/nssfcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: NSSF initial local configuration

                  configuration:
                    nssfName: NSSF # the name of this NSSF
                    sbi: # Service-based interface information
                      scheme: http # the protocol for sbi (http or https)
                      registerIPv4: {{ NSSF_IP_ADDRESS }} # IP used to register to NRF
                      bindingIPv4: {{ NSSF_IP_ADDRESS }}  # IP used to bind the service
                      port: {{ NSSF_PORT }} # Port used to bind the service
                    serviceNameList: # the SBI services provided by this SMF, refer to TS 29.531
                      - nnssf-nsselection # Nnssf_NSSelection service
                      - nnssf-nssaiavailability # Nnssf_NSSAIAvailability service
                    nrfUri: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }} # a valid URI of NRF
                    supportedPlmnList: # the PLMNs (Public land mobile network) list supported by this NSSF
                      - mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)
                        mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                    supportedNssaiInPlmnList: # Supported S-NSSAI List for each PLMN
                      - plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                          mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)
                          mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                        supportedSnssaiList: # Supported S-NSSAIs of the PLMN
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 010203 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 112233 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                    nsiList: # List of available Network Slice Instance (NSI)
                      - snssai: # S-NSSAI of this NSI
                          sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                        nsiInformationList: # Information list of this NSI
                          # the NRF to be used to select the NFs/services within the selected NSI, and an optonal ID
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 10
                      - snssai: # S-NSSAI of this NSI
                          sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        nsiInformationList: # Information list of this NSI
                          # the NRF to be used to select the NFs/services within the selected NSI, and an optonal ID
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 11
                      - snssai: # S-NSSAI of this NSI
                          sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        nsiInformationList: # Information list of this NSI
                          # the NRF to be used to select the NFs/services within the selected NSI, and an optonal ID
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 12
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 12
                      - snssai: # S-NSSAI of this NSI
                          sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        nsiInformationList: # Information list of this NSI
                          # the NRF to be used to select the NFs/services within the selected NSI, and an optonal ID
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 13
                      - snssai: # S-NSSAI of this NSI
                          sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                        nsiInformationList: # Information list of this NSI
                          # the NRF to be used to select the NFs/services within the selected NSI, and an optonal ID
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 20
                      - snssai: # S-NSSAI of this NSI
                          sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                          sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        nsiInformationList: # Information list of this NSI
                          # the NRF to be used to select the NFs/services within the selected NSI, and an optonal ID
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 21
                      - snssai: # S-NSSAI of this NSI
                          sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          sd: 010203 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        nsiInformationList: # Information list of this NSI
                          # the NRF to be used to select the NFs/services within the selected NSI, and an optonal ID
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 22
                      - snssai: # S-NSSAI of this NSI
                          sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          sd: 112233 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        nsiInformationList: # Information list of this NSI
                          # the NRF to be used to select the NFs/services within the selected NSI, and an optonal ID
                          - nrfId: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                            nsiId: 23
                    amfSetList: # List of AMF Sets that my be assigned by this NSSF
                      - amfSetId: 1 # the AMF Set identifier
                        amfList: # Instance ID of the AMFs in this set
                          - ffa2e8d7-3275-49c7-8631-6af1df1d9d26
                          - 0e8831c3-6286-4689-ab27-1e2161e15cb1
                          - a1fba9ba-2e39-4e22-9c74-f749da571d0d
                        # URI of the NRF used to determine the list of candidate AMF(s) from the AMF Set
                        nrfAmfSet: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}/nnrf-nfm/v1/nf-instances
                        # the Nssai availability data information per TA supported by the AMF
                        supportedNssaiAvailabilityData:
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33456 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33457 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                      - amfSetId: 2 # the AMF Set identifier
                        # URI of the NRF used to determine the list of candidate AMF(s) from the AMF Set
                        nrfAmfSet: http://localhost:8084/nnrf-nfm/v1/nf-instances
                        # the Nssai availability data information per TA supported by the AMF
                        supportedNssaiAvailabilityData:
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33456 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33458 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                    amfList: # List of AMFs that may be assigned by this NSSF
                      - nfId: 469de254-2fe5-4ca0-8381-af3f500af77c # ID of this AMF
                        # The NSSAI availability data information per TA supported by the AMF
                        supportedNssaiAvailabilityData:
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33456 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33457 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                      - nfId: fbe604a8-27b2-417e-bd7c-8a7be2691f8d # ID of this AMF
                        # The NSSAI availability data information per TA supported by the AMF
                        supportedNssaiAvailabilityData:
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33458 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33459 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                      - nfId: b9e6e2cb-5ce8-4cb6-9173-a266dd9a2f0c # ID of this AMF
                        # The NSSAI availability data information per TA supported by the AMF
                        supportedNssaiAvailabilityData:
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33456 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                          - tai: # Tracking Area Identifier
                              plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                                mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                                mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                              tac: 33458 # Tracking Area Code (uinteger, range: 0~16777215)
                            supportedSnssaiList: # Supported S-NSSAIs of the tracking area
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                    taList: # List of supported tracking area and their related information of this NSSF instance
                      - tai: # Tracking Area Identity
                          plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                            mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                            mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                          tac: 33456 # Tracking Area Code (uinteger, range: 0~16777215)
                        accessType: 3GPP_ACCESS # Access type of the tracking area
                        supportedSnssaiList: # List of supported S-NSSAIs of the tracking area
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                      - tai: # Tracking Area Identity
                          plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                            mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                            mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                          tac: 33457 # Tracking Area Code (uinteger, range: 0~16777215)
                        accessType: 3GPP_ACCESS # Access type of the tracking area
                        supportedSnssaiList: # List of supported S-NSSAIs of the tracking area
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                      - tai: # Tracking Area Identifier
                          plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                            mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                            mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                          tac: 33458 # Tracking Area Code (uinteger, range: 0~16777215)
                        accessType: 3GPP_ACCESS # Access type of the tracking area
                        supportedSnssaiList: # List of supported S-NSSAIs of the tracking area
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                        restrictedSnssaiList: # List of restricted S-NSSAIs of the tracking area
                          - homePlmnId: # Home PLMN identifier
                              mcc: 310 # Mobile Country Code (3 digits string, digit: 0~9)
                              mnc: 560 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                            sNssaiList: # the S-NSSAIs List
                              - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                      - tai: # Tracking Area Identifier
                          plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                            mcc: 466 # Mobile Country Code (3 digits string, digit: 0~9)
                            mnc: 92 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                          tac: 33459 # Tracking Area Code (uinteger, range: 0~16777215)
                        accessType: 3GPP_ACCESS # Access type of the tracking area
                        supportedSnssaiList: # List of supported S-NSSAIs of the tracking area
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                          - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        restrictedSnssaiList: # List of restricted S-NSSAIs of the tracking area
                          - homePlmnId: # Home PLMN identifier
                              mcc: 310 # Mobile Country Code (3 digits string, digit: 0~9)
                              mnc: 560 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                            sNssaiList: # the S-NSSAIs List
                              - sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                    # List of mappings of S-NSSAI in the serving network and the value of the home network
                    mappingListFromPlmn:
                      - operatorName: NTT Docomo # Home PLMN name
                        homePlmnId: # Home PLMN identifier
                          mcc: 440 # Mobile Country Code (3 digits string, digit: 0~9)
                          mnc: 10 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                        mappingOfSnssai: # List of S-NSSAIs mapping
                          - servingSnssai: # S-NSSAI in the serving network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                            homeSnssai: # S-NSSAI in the home network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 1 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - servingSnssai: # S-NSSAI in the serving network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                            homeSnssai: # S-NSSAI in the home network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - servingSnssai: # S-NSSAI in the serving network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                            homeSnssai: # S-NSSAI in the home network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000004 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - servingSnssai: # S-NSSAI in the serving network
                              sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                            homeSnssai: # S-NSSAI in the home network
                              sst: 2 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                      - operatorName: AT&T Mobility # Home PLMN name
                        homePlmnId: # Home PLMN identifier
                          mcc: 310 # Mobile Country Code (3 digits string, digit: 0~9)
                          mnc: 560 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                        mappingOfSnssai:
                          - servingSnssai: # S-NSSAI in the serving network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000001 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                            homeSnssai: # S-NSSAI in the home network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - servingSnssai: # S-NSSAI in the serving network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000002 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                            homeSnssai: # S-NSSAI in the home network
                              sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                              sd: 000003 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    NSSF:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false
                    OpenApi:
                      debugLevel: info
                      ReportCaller: false
               
            - name  : Remove amfcfg.yaml default file config
              shell : rm amfcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build amfcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/amfcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: AMF initial local configuration

                  configuration:
                    amfName: AMF # the name of this AMF
                    ngapIpList:  # the IP list of N2 interfaces on this AMF
                      - {{ AMF_NGAP_IP_ADDRESS }}
                    sbi: # Service-based interface information
                      scheme: http # the protocol for sbi (http or https)
                      registerIPv4: {{ AMF_IP_ADDRESS }} # IP used to register to NRF
                      bindingIPv4: {{ AMF_IP_ADDRESS }}  # IP used to bind the service
                      port: {{ AMF_PORT }} # port used to bind the service
                    serviceNameList: # the SBI services provided by this AMF, refer to TS 29.518
                      - namf-comm # Namf_Communication service
                      - namf-evts # Namf_EventExposure service
                      - namf-mt   # Namf_MT service
                      - namf-loc  # Namf_Location service
                      - namf-oam  # OAM service
                    servedGuamiList: # Guami (Globally Unique AMF ID) list supported by this AMF
                      # <GUAMI> = <MCC><MNC><AMF ID>
                      - plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                          mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)
                          mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                        amfId: cafe00 # AMF identifier (3 bytes hex string, range: 000000~FFFFFF)
                    supportTaiList:  # the TAI (Tracking Area Identifier) list supported by this AMF
                      - plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                          mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)
                          mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                        tac: 1 # Tracking Area Code (uinteger, range: 0~16777215)
                    plmnSupportList: # the PLMNs (Public land mobile network) list supported by this AMF
                      - plmnId: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                          mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)
                          mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                        snssaiList: # the S-NSSAI (Single Network Slice Selection Assistance Information) list supported by this AMF
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 010203 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                          - sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                            sd: 112233 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                    supportDnnList:  # the DNN (Data Network Name) list supported by this AMF
                      - internet
                    nrfUri: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }} # a valid URI of NRF
                    security:  # NAS security parameters
                      integrityOrder: # the priority of integrity algorithms
                        - NIA2
                        # - NIA0
                      cipheringOrder: # the priority of ciphering algorithms
                        - NEA0
                        # - NEA2
                    networkName:  # the name of this core network
                      full: free5GC
                      short: free
                    t3502Value: 720  # timer value (seconds) at UE side
                    t3512Value: 3600 # timer value (seconds) at UE side
                    non3gppDeregistrationTimerValue: 3240 # timer value (seconds) at UE side
                    # retransmission timer for paging message
                    t3513:
                      enable: true     # true or false
                      expireTime: 6s   # default is 6 seconds
                      maxRetryTimes: 4 # the max number of retransmission
                    # retransmission timer for NAS Deregistration Request message
                    t3522:
                      enable: true     # true or false
                      expireTime: 6s   # default is 6 seconds
                      maxRetryTimes: 4 # the max number of retransmission
                    # retransmission timer for NAS Registration Accept message
                    t3550:
                      enable: true     # true or false
                      expireTime: 6s   # default is 6 seconds
                      maxRetryTimes: 4 # the max number of retransmission
                    # retransmission timer for NAS Authentication Request/Security Mode Command message
                    t3560:
                      enable: true     # true or false
                      expireTime: 6s   # default is 6 seconds
                      maxRetryTimes: 4 # the max number of retransmission
                    # retransmission timer for NAS Notification message
                    t3565:
                      enable: true     # true or false
                      expireTime: 6s   # default is 6 seconds
                      maxRetryTimes: 4 # the max number of retransmission

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    AMF:
                      debugLevel: info
                      ReportCaller: false
                    NAS:
                      debugLevel: info
                      ReportCaller: false
                    FSM:
                      debugLevel: info
                      ReportCaller: false
                    NGAP:
                      debugLevel: info
                      ReportCaller: false
                    Aper:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false
                    OpenApi:
                      debugLevel: info
                      ReportCaller: false

            - name  : Remove pcfcfg.yaml default file config
              shell : rm pcfcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build pcfcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/pcfcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: PCF initial local configuration

                  configuration:
                    pcfName: PCF # the name of this PCF
                    sbi: # Service-based interface information
                      scheme: http # the protocol for sbi (http or https)
                      registerIPv4: {{ PCF_IP_ADDRESS }} # IP used to register to NRF
                      bindingIPv4: {{ PCF_IP_ADDRESS }}  # IP used to bind the service
                      port: {{ PCF_PORT }}              # port used to bind the service
                    timeFormat: 2019-01-02 15:04:05 # time format of this PCF
                    defaultBdtRefId: BdtPolicyId-   # BDT Reference ID, indicating transfer policies of background data transfer.
                    nrfUri: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }}  # a valid URI of NRF
                    serviceList:   # the SBI services provided by this PCF, refer to TS 29.507
                      - serviceName: npcf-am-policy-control # Npcf_AMPolicyControl service
                      - serviceName: npcf-smpolicycontrol   # Npcf_SMPolicyControl service
                        suppFeat: 3fff # the features supported by Npcf_SMPolicyControl, name defined in TS 29.512 5.8-1, value defined in TS 29.571 5.2.2
                      - serviceName: npcf-bdtpolicycontrol    # Npcf_BDTPolicyControl service
                      - serviceName: npcf-policyauthorization # Npcf_PolicyAuthorization service
                        suppFeat: 3    # the features supported by Npcf_PolicyAuthorization, name defined in TS 29.514 5.8-1, value defined in TS 29.571 5.2.2
                      - serviceName: npcf-eventexposure       # Npcf_EventExposure service
                      - serviceName: npcf-ue-policy-control   # Npcf_UEPolicyControl service
                    mongodb:       # the mongodb connected by this PCF
                      name: free5gc                  # name of the mongodb
                      url: {{ MONGO_URL_CONNECTION }} # a valid URL of the mongodb

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    PCF:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false
                    OpenApi:
                      debugLevel: info
                      ReportCaller: false

            - name  : Remove smfcfg.yaml default file config
              shell : rm smfcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build smfcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/smfcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: SMF initial local configuration

                  configuration:
                    smfName: SMF # the name of this SMF
                    sbi: # Service-based interface information
                      scheme: http # the protocol for sbi (http or https)
                      registerIPv4: {{ SMF_IP_ADDRESS }} # IP used to register to NRF
                      bindingIPv4: {{ SMF_IP_ADDRESS }}  # IP used to bind the service
                      port: {{ SMF_PORT }} # Port used to bind the service
                      tls: # the local path of TLS key
                        key: free5gc/support/TLS/smf.key # SMF TLS Certificate
                        pem: free5gc/support/TLS/smf.pem # SMF TLS Private key
                    serviceNameList: # the SBI services provided by this SMF, refer to TS 29.502
                      - nsmf-pdusession # Nsmf_PDUSession service
                      - nsmf-event-exposure # Nsmf_EventExposure service
                      - nsmf-oam # OAM service
                    snssaiInfos: # the S-NSSAI (Single Network Slice Selection Assistance Information) list supported by this AMF
                      - sNssai: # S-NSSAI (Single Network Slice Selection Assistance Information)
                          sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          sd: 010203 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        dnnInfos: # DNN information list
                          - dnn: internet # Data Network Name
                            dns: # the IP address of DNS
                              ipv4: 8.8.8.8
                              ipv6: 2001:4860:4860::8888
                            ueSubnet: 60.60.0.0/16 # should be CIDR type
                      - sNssai: # S-NSSAI (Single Network Slice Selection Assistance Information)
                          sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                          sd: 112233 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                        dnnInfos: # DNN information list
                          - dnn: internet # Data Network Name
                            dns: # the IP address of DNS
                              ipv4: 8.8.8.8
                              ipv6: 2001:4860:4860::8888
                            ueSubnet: 60.61.0.0/16 # should be CIDR type
                    pfcp: # the IP address of N4 interface on this SMF (PFCP)
                      addr: 127.0.0.1
                    userplane_information: # list of userplane information
                      up_nodes: # information of userplane node (AN or UPF)
                        gNB1: # the name of the node
                          type: AN # the type of the node (AN or UPF)
                        UPF:  # the name of the node
                          type: UPF # the type of the node (AN or UPF)
                          node_id: {{ UPF_IP_ADDRESS }} # the IP/FQDN of N4 interface on this UPF (PFCP)
                          sNssaiUpfInfos: # S-NSSAI information list for this UPF
                            - sNssai: # S-NSSAI (Single Network Slice Selection Assistance Information)
                                sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 010203 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              dnnUpfInfoList: # DNN information list for this S-NSSAI
                                - dnn: internet
                            - sNssai: # S-NSSAI (Single Network Slice Selection Assistance Information)
                                sst: 1 # Slice/Service Type (uinteger, range: 0~255)
                                sd: 112233 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                              dnnUpfInfoList: # DNN information list for this S-NSSAI
                                - dnn: internet
                          interfaces: # Interface list for this UPF
                            - interfaceType: N3 # the type of the interface (N3 or N9)
                              endpoints: # the IP address of this N3/N9 interface on this UPF
                                - {{ SMF_N3_INTERFACE_IP_ADDRESS }}
                              networkInstance: internet # Data Network Name (DNN)
                      links: # the topology graph of userplane, A and B represent the two nodes of each link
                        - A: gNB1
                          B: UPF
                    nrfUri: http://{{ NRF_IP_ADDRESS }}:{{ NRF_PORT }} # a valid URI of NRF

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    SMF:
                      debugLevel: info
                      ReportCaller: false
                    NAS:
                      debugLevel: info
                      ReportCaller: false
                    NGAP:
                      debugLevel: info
                      ReportCaller: false
                    Aper:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false
                    OpenApi:
                      debugLevel: info
                      ReportCaller: false
                    PFCP:
                      debugLevel: info
                      ReportCaller: false
              
            - name  : Remove n3iwfcfg.yaml default file config
              shell : rm n3iwfcfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build n3iwfcfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/n3iwfcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: N3IWF initial local configuration

                  configuration:
                    N3IWFInformation:
                      GlobalN3IWFID: # ID used to globally identify an N3IWF
                        PLMNID: # Public Land Mobile Network ID, <PLMN ID> = <MCC><MNC>
                          MCC: # Mobile Country Code (3 digits string, digit: 0~9)
                            208
                          MNC: # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                            93
                        N3IWFID: # ID used to identify an N3IWF in PLMN (uinteger, range: 0~65535)
                          135
                      Name: # The name of this N3IWF
                        free5GC_N3IWF
                      SupportedTAList: # Tracking Area supported by this N3IWF
                        - TAC: # Tracking Area Code (3 bytes hex string, range: 000000~FFFFFF)
                            000001
                          BroadcastPLMNList: # Refer to TS 38.413
                            - PLMNID: # Public Land Mobile Network ID
                                MCC: # Mobile Country Code (3 digits string, digit: 0~9)
                                  208
                                MNC: # Mobile Network Code (2 or 3 digits string, digit: 0~9)
                                  93
                              TAISliceSupportList: # Network Slice supported in this TAI
                                - SNSSAI: # Single Network Slice Selection Assistance Information
                                    SST: # Slice/Service Type (1 byte hex string, range: 0~F)
                                      1
                                    SD: # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)
                                      010203
                                - SNSSAI:
                                    SST:
                                      1
                                    SD:
                                      112233
                    AMFSCTPAddresses: # the IP list of N2 interfaces (SCTP) on AMF when using NGAP
                      - IP:
                        - 10.200.200.1


                    # --- Bind Interfaces ---
                    IKEBindAddress: # IP address of Nwu interface (IKE) on this N3IWF
                      192.168.127.1

                    IPSecInterfaceAddress: # IP address of IPSec virtual interface (IPsec tunnel enpoint on this N3IWF)
                      10.0.0.1

                    IPSecInterfaceMark: # IPSec virtual interface mark (Any value except to 0, default value is 7 if not defined)
                      5

                    GTPBindAddress: # IP address of N3 interface (GTP) on this N3IWF
                      10.200.200.2

                    NASTCPPort: # TCP port which the NAS listens on
                      20000

                    FQDN: # FQDN of this N3IWF
                      n3iwf.free5gc.org


                    # --- Security ---
                    PrivateKey: # Private key file path

                    CertificateAuthority: # Certificate Authority (CA) file path

                    Certificate: # Certificate file path



                    UEIPAddressRange: # IP address allocated to UE in IPSec tunnel
                      10.0.0.0/24

                  # the kind of log output
                    # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                    # ReportCaller: enable the caller report or not, value: true or false
                  logger:
                    N3IWF:
                      debugLevel: info
                      ReportCaller: false
                    NGAP:
                      debugLevel: info
                      ReportCaller: false
                    Aper:
                      debugLevel: info
                      ReportCaller: false
                    PathUtil:
                      debugLevel: info
                      ReportCaller: false

            - name  : Checkout the WebConsole version v1.0.1 - required for free5gc version is v3.0.5
              shell : git checkout v1.0.1
              args:
                chdir: "{{ WEB_CONSOLE_BASE_DIR }}"
              when  : FREE5GC == 'true'

            - name  : Remove webuicfg.yaml default file config
              shell : rm webuicfg.yaml
              args:
                chdir: "{{ NFS_DIR_CONFIG }}"

            - name  : Build webuicfg.yaml config file
              copy:
                dest: "{{ NFS_DIR_CONFIG }}/webuicfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: WebUI initial local configuration

                  configuration:
                    mongodb: # the mongodb connected by this webui
                      name: free5gc # name of the mongodb
                      url: {{ MONGO_URL_CONNECTION }} # a valid URL of the mongodb

            - name  : Build all NFs freee5gc
              shell : make
              args:
                chdir: "{{ FREE5GC_DIR_INSTALL }}"

            - name  : BuilD WebConsole
              shell :  |
                    yarn install
                    yarn build
                    rm -rf ../public
                    cp -R build ../public
              args:
                chdir: "{{ WEB_CONSOLE_FRONTEND_DIR }}"

            - name  : Build WebConsole
              shell :  |
                    go build -o bin/webconsole server.go
              args:
                chdir: "{{ WEB_CONSOLE_BASE_DIR }}"

            - name  : Remove UPF default file config
              shell : rm upfcfg.yaml
              args:
                chdir: "{{ UPF_DIR_CONFIG }}"

            - name  : Build upfcfg.yaml config file
              copy:
                dest: "{{ UPF_DIR_CONFIG }}/upfcfg.yaml"
                content: |
                  info:
                    version: 1.0.0
                    description: UPF configuration
                  
                  configuration:
                    # the kind of log output
                      # debugLevel: how detailed to output, value: trace, debug, info, warn, error, fatal, panic
                      # ReportCaller: enable the caller report or not, value: true or false
                    debugLevel: info
                    ReportCaller: false

                    # The IP list of the N4 interface on this UPF (Can't set to 0.0.0.0)
                    pfcp:
                      - addr: {{ UPF_IP_ADDRESS }}
                    # The IP list of the N3/N9 interfaces on this UPF
                    # If there are multiple connection, set addr to 0.0.0.0 or list all the addresses
                    gtpu:
                      - addr: {{ GTPU_UPF_IP_ADDRESS }}
                      # [optional] gtpu.name
                      # - name: upf.5gc.nctu.me
                      # [optional] gtpu.ifname
                      # - ifname: gtpif

                    # The DNN list supported by UPF
                    dnn_list:
                      - dnn: internet # Data Network Name
                        cidr: 60.60.0.0/24 # Classless Inter-Domain Routing for assigned IPv4 pool of UE
                        # [optional] dnn_list[*].natifname
                        # natifname: eth0
