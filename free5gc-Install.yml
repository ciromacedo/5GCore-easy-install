---
    -   hosts: 127.0.0.1
        connection: local
        become: yes
        remote_user: root
        vars:
            GTP5G_DIR_INSTALL : "/root/gtp5g"
            FREE5GC_DIR_INSTALL : "/root/free5gc"
            home_dir: "/root"
            file_owner: "root"
            GO_VERSION: "1.14.4"
        tasks:
            - fail: 
                msg: "'internet_network_interface' not found, this parameter is required!"
              when: internet_network_interface == ''

            - name: Environment validation!
              assert:
                that:
                  - ansible_memtotal_mb >= 500
                msg: "Minimum memory requirements in the deployment environment is 4GB! Operation failed!"
    
            - name: Upgrade all apt packages
              apt: upgrade=dist force_apt_get=yes
            
            - name: Install Basic requirements
              apt:
                    name: ['mongodb', 'wget', 'git', 'ca-certificates', 'net-tools', 'gcc', 'cmake', 'autoconf', 'build-essential', 'libtool', 'pkg-config', 'libmnl-dev', 'libyaml-dev']
                    state: present
                    update_cache: yes

            - name: Start Mongo-DB
              shell:  sudo systemctl start mongodb

#            - name: Remove Go-lang install 1/2
#              shell:  sudo rm -rf /usr/local/go
#              ignore_errors: true

#            - name: Remove Go-lang install 1/2
#              shell:  apt remove golang-go
#              ignore_errors: true

            - name: Remove GTP5G (if exists)
              shell:  sudo rm -rf {{ GTP5G_DIR_INSTALL }}
              ignore_errors: true

            - name: Remove free5GC dir (if exists)
              shell:  sudo rm -rf {{ FREE5GC_DIR_INSTALL }}
              ignore_errors: true

#            - name: Install Go 1.14.4 - 1/5
#              shell:  wget https://dl.google.com/go/go1.14.4.linux-amd64.tar.gz

#            - name: Install Go 1.14.4 - 2/5
#              shell:  sudo tar -C /usr/local -zxvf go1.14.4.linux-amd64.tar.gz

#            - name: Install Go 1.14.4 - 3/5
#              shell:  mkdir -p ~/go/{bin,pkg,src}

#            - name: Install Go 1.14.4 - 4/5
#              shell:  |
#                    echo 'export GOPATH=$HOME/go' >> ~/.bashrc
#                    echo 'export GOROOT=/usr/local/go' >> ~/.bashrc
#                    echo 'export PATH=$PATH:$GOPATH/bin:$GOROOT/bin' >> ~/.bashrc
#                    echo 'export GO111MODULE=auto' >> ~/.bashrc

            - name: download golang tar 
              get_url:
                url: "https://storage.googleapis.com/golang/go{{GO_VERSION}}.linux-amd64.tar.gz"
                dest: "{{home_dir}}"
                mode: 0440
                
            - name: Remove old installation of Go
              file:
                path: /usr/local/go
                state: absent
              become: yes
            
            - name: Extract the Go tarball
              unarchive:
                src: "{{home_dir}}/go{{GO_VERSION}}.linux-amd64.tar.gz"
                dest: /usr/local
                copy: no
              become: yes
            
            - name: create go directories in home
              file:
                path: "{{item}}"
                state: directory
                owner: "{{file_owner}}"
                group: "{{file_owner}}"
                mode: 0775
              with_items:
                - "{{home_dir}}/go"
                - "{{home_dir}}/go/bin"
                
            - name: modify .bashrc
              blockinfile:
                dest: "{{home_dir}}/.bashrc"
                block: |
                  export GOPATH=$HOME/go
                  export GOBIN=$GOPATH/bin
                  export PATH=$GOBIN:$PATH:/usr/local/go/bin
                marker: '# {mark} ANSIBLE MANAGED BLOCK - changes for golang'
                insertafter: EOF
                create: yes 
            
 #           - name: Install Go 1.14.4 - 5/5
 #             shell:  source ~/.bashrc
 #             args:
 #               executable: /bin/bash
 #             become: true
 #             become_user: root

#            - git: 
#                repo: 'https://github.com/PrinzOwO/gtp5g.git'
#                dest: "{{ GTP5G_DIR_INSTALL }}"
#                version: v0.1.0

#            - name: Install linux-headers-5.0.0-23-generic
#              shell:  sudo apt-get install -y linux-headers-5.0.0-23-generic

#            - name  : Run 'Make' into GTP5G
#              shell : make
#              args:
#                chdir: "{{ GTP5G_DIR_INSTALL }}"

#            - name  : Install GTP5G
#              shell : sudo make install
#              args:
#                chdir: "{{ GTP5G_DIR_INSTALL }}"

#            - name  : Network Setting 1/3
#              shell : sudo sysctl -w net.ipv4.ip_forward=1

#            - name  : Network Setting 2/3
#              shell : sudo iptables -t nat -A POSTROUTING -o {{ internet_network_interface }} -j MASQUERADE

#            - name  : Network Setting 3/3
#              shell : sudo systemctl stop ufw

#            - git: 
#                repo: 'https://github.com/my5G/my5Gcore.git'
#                dest: '{{ FREE5GC_DIR_INSTALL }}'
#                version: master

#            - name  : Clone my5GCore project
#              shell : |
#                    git submodule sync
#                    git submodule update --init --jobs `nproc`
#                    git submodule foreach git checkout master
#                    git submodule foreach git pull --jobs `nproc`
#              args:
#                chdir: "{{ FREE5GC_DIR_INSTALL }}"


#            - name  : my5GCore - Install dependent packages
#              shell : go mod download
#              args:
#                chdir: "{{ FREE5GC_DIR_INSTALL }}"


#            - name  : my5GCore - Compile network function services
#              shell : make all
#              args:
#                chdir: "{{ FREE5GC_DIR_INSTALL }}"

                
